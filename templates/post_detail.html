<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detail</title>
    <link rel="stylesheet" type="text/css" href="/static/css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&display=swap" rel="stylesheet">
    <style>
        /* æ ·å¼å®šä¹‰ */
        #loading {
            display: block;
            text-align: center;
            font-size: 1.5em;
        }
        #post-content {
            display: none; /* åˆå§‹éšè— */
        }
    </style>
</head>
<body>
    <div id="loading">ğŸ”„ Loading...</div>

    <div id="post-content">
        <h1 id="post-title"></h1>
        <div id="post-body"></div>
        <a href="/">â†©ï¸ Back</a>
    </div>

    <script>
        const postId = getPostIdFromUrl();
        console.log("postId = " + postId);
        
        document.addEventListener("DOMContentLoaded", function () {
            fetch(`/get_detail?id=${postId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        document.getElementById("loading").innerText = "âŒ " + data.error;
                        return;
                    }
                    // æ˜¾ç¤º post æ•°æ®
                    document.getElementById("post-title").innerText = data.title;
                    document.getElementById("post-body").innerHTML = data.content;

                    // éšè—åŠ è½½æŒ‡ç¤ºå™¨ï¼Œæ˜¾ç¤ºå†…å®¹
                    document.getElementById("loading").style.display = "none";
                    document.getElementById("post-content").style.display = "block";

                    // æ ‡è®° post ä¸ºå·²è¯»
                    markPostAsRead(postId);
                })
                .catch(error => {
                    console.error('Error loading post:', error);
                    document.getElementById("loading").innerText = "âŒ Error loading post!";
                });
        });

        function markPostAsRead(postId) {
            // è°ƒç”¨ markRead API æ ‡è®°ä¸ºå·²è¯»
            fetch('/mark_read', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ post_id: postId })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Marked post as read:', data);
            })
            .catch(error => {
                console.error('Error marking post as read:', error);
            });
        }

        function getPostIdFromUrl() {
            const url = window.location.href;
            console.log(url);
            const urlParams = new URLSearchParams(new URL(url).search);
            const id = urlParams.get('id');
            console.log(id);
            return id;
        }
    </script>
</body>
</html>