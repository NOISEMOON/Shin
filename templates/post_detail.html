<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detail</title>
    <link rel="stylesheet" type="text/css" href="/static/css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&display=swap" rel="stylesheet">
</head>

<body>
    <div id="loading">üîÑ Loading...</div>

    <div id="post-content">
        <h1 id="post-title"></h1>
        <div id="post-body"></div>
    </div>
    <div id="back"><a href="/">‚Ü©Ô∏è Back</a></div>

    <script>
        const postId = getPostIdFromUrl();

        document.addEventListener("DOMContentLoaded", function () {
            fetch(`/get_detail?id=${postId}`, {
                method: 'GET'
            })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        document.getElementById("loading").innerText = "‚ùå " + data.error;
                        return;
                    }
                    // ÊòæÁ§∫ post Êï∞ÊçÆ
                    document.getElementById("post-title").innerText = data.title;
                    document.getElementById("post-body").innerHTML = data.content;

                    // ÈöêËóèÂä†ËΩΩÊåáÁ§∫Âô®ÔºåÊòæÁ§∫ÂÜÖÂÆπ
                    document.getElementById("loading").style.display = "none";
                    document.getElementById("post-content").style.display = "block";

                    // Ê†áËÆ∞ post ‰∏∫Â∑≤ËØª
                    markPostAsRead(postId);
                })
                .catch(error => {
                    console.error('Error loading post:', error);
                    document.getElementById("loading").innerText = "‚ùå Error loading post!";
                });
        });

        function markPostAsRead(postId) {
            // Ë∞ÉÁî® markRead API Ê†áËÆ∞‰∏∫Â∑≤ËØª
            fetch('/mark_read', {
                method: 'POST',
                body: JSON.stringify({ post_id: postId })
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Marked post as read:', data);
                })
                .catch(error => {
                    console.error('Error marking post as read:', error);
                });
        }

        function getPostIdFromUrl() {
            const url = window.location.href;
            const urlParams = new URLSearchParams(new URL(url).search);
            const id = urlParams.get('id');
            return id;
        }
    </script>
</body>

</html>